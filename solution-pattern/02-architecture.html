<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solution Patterns: Connect, Secure and Protect with Red Hat Connectivity Link :: Solution Patterns from Red Hat</title>
    <link rel="canonical" href="https://solutionpatterns.io/solution-pattern/02-architecture.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="03-demo.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TKK0SMEFQH"></script>
<script>function gtag() { dataLayer.push(arguments) }; window.dataLayer = window.dataLayer || []; gtag('js', new Date()); gtag('config', 'G-TKK0SMEFQH')</script>
  </head>
  <body class="article">

<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const managedzone = urlParams.get('AWSROOTZONE');
      const subdomain = urlParams.get('OPENSHIFTSUBDOMAIN'); 
      if (managedzone) {
        showManagedZone( managedzone, subdomain);
      }
      else {
        showManagedZoneForm(subdomain);
      }
    } );


    function showManagedZone( managedzone, subdomain) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('managedZoneDisplay').textContent = "AWS Root Zone: " + managedzone;
      document.getElementById('subdomainDisplay').textContent = "OpenShift Subdomain: " + subdomain; 
    }

    function showManagedZoneForm( subdomain ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
      document.getElementById('subdomain').value = subdomain; 

    }

    function goWithManagedZone() {
      elManagedZoneInput = document.getElementById('managedzone');
      elSubdomainInput = document.getElementById('subdomain');
      window.location.search = ('&AWSROOTZONE=' + elManagedZoneInput.value  + '&OPENSHIFTSUBDOMAIN=' + elSubdomainInput.value);
    }

    function recycle() {
      document.getElementById('managedzone').value='';
      document.getElementById('subdomain').value='';
      window.location.search = ('');
    }


  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white" href="https://solutionpatterns.io">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns from Red Hat</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Architectures &amp; Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
            <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html"  target="_blank">Solution Patterns </a>
            <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
            <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
            <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
          </div>
        </div>

          <a class="navbar-item" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>
          <a class="navbar-item" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

          <div class="navbar-item" >         
              <div id="navbar-form-empty">
                <span >
                  <span>
                    &nbsp;
                    <i style="color: orange;" class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                  </span>
                  Your Workshop Environment
                <form action="javascript:void(0);" onsu>
                  <input size="20" id="managedzone" type="text" placeholder="AWS ROOT ZONE">
                  <input size="20" id="subdomain" type="text" placeholder="OPENSHIFT SUBDOMAIN">
                  <button type="hidden" onclick="goWithManagedZone();">Set</button>
                </form>
                </span>
              </div>
        
              <div  id="navbar-form-filled" style="display: none;">
                <span>
                <span>
                  Your Workshop Environment
                    <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">
                    <i alt="Clear details" title="Clear details" onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i>
                    <br><span  id="managedZoneDisplay"></span> <span>|</span>
                <span id="subdomainDisplay"></span>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>

<div class="body">
<div class="nav-container" data-component="solution-pattern" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Connectivity Link</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.3 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tech_stack">2.1. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#in_depth">2.2. An in-depth look at the solution&#8217;s architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#more_tech">2.3. More about the technology stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#_prerequisites">3.1. Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03.1-platform.html">3.2. Platform Engineer workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03.2-developer.html">3.3. Developer workflow</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-resources.html">4. Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Connectivity Link</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Connectivity Link</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Connectivity Link</a></li>
    <li><a href="02-architecture.html">2. Architecture</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/jayachristina/soln-pattern-connectivity-link/edit/main/documentation/modules/ROOT/pages/02-architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Solution Patterns: Connect, Secure and Protect with Red Hat Connectivity Link</h1>
<h1 id="_architecture" class="sect0"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">Architecture</a></h1>
<div class="sect1">
<h2 id="_common_challenges_addressed"><a class="anchor" href="#_common_challenges_addressed"></a><a class="link" href="#_common_challenges_addressed">1. Common Challenges addressed</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Hybrid Cloud becoming the defacto standard, Platform Engineering teams face increased complexity of setting up and running environments across multiple clusters and multiple regions.</p>
</div>
<div class="paragraph">
<p>There is a need to  make it easy to connect, protect and manage services and infrastructure across the different environments to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide a connectivity solution that leverages Gateway API as its foundation which enables platform engineers and application developers to collaborate to connect, secure, protect and observe their HTTP based APIs and infrastructure leveraging CRD based APIs rather than additional heavy weight platforms.</p>
</li>
<li>
<p>Provide a lightweight layer of API management focused tooling that provides an “API management lens” that compliments the core connectivity features.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tech_stack"><a class="anchor" href="#tech_stack"></a><a class="link" href="#tech_stack">2. Technology Stack</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Red Hat supported products</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.redhat.com/products/red-hat-connectivity-link/overview" target="_blank" rel="noopener">Red Hat Connectivity Link</a></p>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/cloud-computing/openshift" target="_blank" rel="noopener">Red Hat OpenShift</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/products/red-hat-build-of-keycloak/" target="_blank" rel="noopener">Red Hat build of Keycloak</a></p>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/cloud-computing/openshift/what-is-openshift-service-mesh" target="_blank" rel="noopener">Red Hat OpenShift Service Mesh</a></p>
</li>
<li>
<p>Red Hat Application Foundation</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/products/quarkus">Quarkus</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Other open source products:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://helm.sh/" target="_blank" rel="noopener">Helm</a></p>
</li>
<li>
<p><a href="https://cert-manager.io" target="_blank" rel="noopener">cert-manager</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>DNS Provider in this example</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/route53" target="_blank" rel="noopener">Amazon Route 53</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="in_depth"><a class="anchor" href="#in_depth"></a><a class="link" href="#in_depth">3. An in-depth look at the solution&#8217;s architecture</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>With growing demand for mobile based apps, Globex gears to support access to their core services from other channels/applications. In this solution we will look at a step-by-step approach to onboarding a new application and allowing to access the Globex services in a secure fashion.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture.png" alt="architecture">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Globex&#8217;s development team built a <code>Mobile Gateway</code> as a single point of entry (a wrapper) in front of Globex&#8217;s core services. Ref: <a href="https://martinfowler.com/articles/gateway-pattern.html" target="_blank" rel="noopener">gateway-pattern</a></p>
</li>
<li>
<p>The access to this <code>mobile-gateway</code> service endpoint needs to be secured and protected for connectivity from the Mobile App that is being built.</p>
</li>
<li>
<p>To setup such a secure connectivity for a growing demand for access to core services, the Globex team adopts a Kubernetes native approach to application connectivity through Red Hat Connectivity Link.</p>
</li>
<li>
<p>Connectivity Link allows for clear separation of concerns with regard to the various teams involved in setting up such a secure connectivity</p>
</li>
<li>
<p><strong>Platform Engineers</strong> workflow:<br>
The Platform Engineer has to setup a Gateway which will allow for secure connection to the backend service endpoints. To achieve this a number of components need to be setup.</p>
<details>
<summary class="title"><span class="underline">Click to view details about these components</span></summary>
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A Managed Zone needs to be setup within the DNS provider. E.g.  <code>managed.globex.com</code>.<br>
Refer to the <a href="https://developers.redhat.com/articles/2024/06/12/getting-started-red-hat-connectivity-link-openshift" target="_blank" rel="noopener">Getting started page</a>  to learn how to setup a Managed Zone.</p>
</li>
<li>
<p><strong>TLS issuer</strong> (a.k.a ClusterIssuer): Sets up a Certificate Issuer to create TLS certificates that are needed to secure communication. In this case, Globex uses <a href="https://letsencrypt.org/" target="_blank" rel="noopener">Let&#8217;s Encrypt</a>. This certificate is stored as a secret to be referenced by the Gateways.</p>
</li>
<li>
<p><a href="https://gateway-api.sigs.k8s.io/api-types/gateway/" target="_blank" rel="noopener"><strong>Gateway</strong></a>: create a new Gateway (using the Gateway API and Istio-based controllers) as an entrypoint for all requests to Globex&#8217;s system. The Gateway uses the TLS Certificates created by the TLS Issuer.  Also a number of policies are setup to secure and protect the Gateway.</p>
</li>
<li>
<p><a href="https://docs.kuadrant.io/0.8.0/kuadrant-operator/doc/tls/" target="_blank" rel="noopener"><strong>TLS Policy</strong></a>: leverages the TLS-issuer/CertificateIssuer to set up TLS certificates for the listeners defined within the Gateway. Listeners define the hostname for the various incoming requests and is denoted with a wildcard hostname based on the root domain. These gateways can use a subdomain of the Managed Zone. E.g.  <code>*.managed.globex.com</code>.</p>
</li>
<li>
<p><a href="https://docs.kuadrant.io/0.8.0/kuadrant-operator/doc/auth/" target="_blank" rel="noopener"><strong>Auth Policy</strong></a>: setup a zero-trust deny-all policy that result in a default 403 response for any unprotected endpoints.</p>
</li>
<li>
<p><a href="https://docs.kuadrant.io/0.8.0/kuadrant-operator/doc/dns/" target="_blank" rel="noopener"><strong>DNS Policy</strong></a>: provide DNS management by managing the lifecycle of DNS records to setup ingress connectivity using DNS to bring traffic to the Gateway.</p>
</li>
<li>
<p><a href="https://docs.kuadrant.io/0.8.0/kuadrant-operator/doc/rate-limiting/" target="_blank" rel="noopener"><strong>RateLimit Policy</strong></a>: set up a default artificially low global limit to further protect any endpoints exposed by this Gateway.</p>
</li>
</ol>
</div>
</div>
</details>
</li>
<li>
<p><strong>Developer/Application owners</strong> workflow:<br>
Now that the Gateway is made available, the developers can now start onboarding their service endpoints by creating a HTTPRoute representing each endpoint. Developers can also override the Auth and RateLimit policies setup by the Platform Engineer to suit their specific authz/authn needs and  non-functional requirements for rate limiting.</p>
<details>
<summary class="title"><span class="underline">Click to view details about these components</span></summary>
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><a href="https://gateway-api.sigs.k8s.io/api-types/httproute/" target="_blank" rel="noopener"><strong>HTTPRoute</strong></a>: this is part of the Gateway API. Setup a HTTPRoute by defining the parent Gateway that was setup by Platform Engineer. Define a hostname for the route so that requests can be sent to the correct route. Rules can be setup to send the requests to the right backend endpoint.</p>
</li>
<li>
<p><strong>AuthPolicy</strong>: Globex adopts OIDC for auth and the developer creates a new policy attached to the HTTPRoute. This policy overrides the <code>deny-all</code> policy created by the Platform Engineer.</p>
</li>
<li>
<p><strong>RateLimit Policy</strong>: the low-limits default RateLimit Policy created at the Gateway level is overridden by this policy to provide for a suitable limit based on non-functional requirements. Any changes can be made easily to the system by applying changes to this policy.</p>
</li>
</ol>
</div>
</div>
</details>
</li>
<li>
<p>Once the components and custom resources are in place, a Globex customer can login to the Globex Mobile application. The request will then be served securely through the Connectivity Link platform that has been setup.</p>
</li>
<li>
<p>Suitable metrics can also be enabled which will be covered in the next version of this Solution Pattern.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="more_tech"><a class="anchor" href="#more_tech"></a><a class="link" href="#more_tech">4. About the Technology Stack</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_gateway_api"><a class="anchor" href="#_what_is_gateway_api"></a><a class="link" href="#_what_is_gateway_api">4.1. What is Gateway API</a></h3>
<div class="paragraph">
<p><a href="https://gateway-api.sigs.k8s.io/" target="_blank" rel="noopener">Gateway API</a>This is the new standard for Ingress from the Kubernetes community.</p>
</div>
<div class="paragraph">
<p>Gateway API is a relatively new Kubernetes based API focused on traffic routing and is often referred to as the next generation of Ingress on kube.</p>
</div>
<div class="paragraph">
<p>Used to define the Gateways and Routing rules for requests entering those gateways. Our supported provider is Istio via OpenShift Service Mesh.</p>
</div>
<div class="paragraph">
<p>Connectivity Link (Kuadrant) provides connectivity, security and service protection capabilities in the form of Kubernetes CRDs that implement the Gateway API concept of policy attachment. These policy APIs can target specific Gateway API resources such as Gateways and HTTPRoutes to extend their capabilities and configuration.</p>
</div>
<div class="sect3">
<h4 id="_istio_as_gateway_provider"><a class="anchor" href="#_istio_as_gateway_provider"></a><a class="link" href="#_istio_as_gateway_provider">4.1.1. Istio as Gateway provider</a></h4>
<div class="paragraph">
<p>Connectivity Link/Kuadrant&#8217;s focus is on HTTP traffic and Istio/OpenShift Service Mesh as a supported Gateway API implementation. Istio is the Gateway API provider that Connectivity Link integrates with (via WASM and Istio APIS) to provide service protection capabilities. It configures Envoy via the Istio control plane to enforce the applied policies and register components such as Authorino and Limitador.+
Ref: <a href="https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/" class="bare">https://istio.io/latest/docs/tasks/traffic-management/ingress/gateway-api/</a> [Istio with Gateway API]</p>
</div>
</div>
<div class="sect3">
<h4 id="_httproute"><a class="anchor" href="#_httproute"></a><a class="link" href="#_httproute">4.1.2. HTTPRoute</a></h4>
<div class="paragraph">
<p>HTTPRoute enables advanced routing capabilities for Ingress. It is a Gateway API type for specifying routing behavior of HTTP requests from a Gateway listener to an API object, i.e. Service.<br>
Ref: <a href="https://gateway-api.sigs.k8s.io/api-types/httproute/" class="bare">https://gateway-api.sigs.k8s.io/api-types/httproute/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_kuadrant"><a class="anchor" href="#_what_is_kuadrant"></a><a class="link" href="#_what_is_kuadrant">4.2. What is Kuadrant</a></h3>
<div class="videoblock">
<div class="content">
<iframe width="800" height="480" src="https://www.youtube.com/embed/euWAMvQojP4?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>It enables platform engineers and application developers to easily connect, secure, and protect their services and infrastructure across multiple clusters with policies for TLS, DNS, application authentication &amp; authorization, and rate limiting. Additionally, Kuadrant offers observability templates to further support infrastructure management.<br>
Ref: <a href="https://docs.kuadrant.io" class="bare">https://docs.kuadrant.io</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_kuadrant_list_of_underlying_components"><a class="anchor" href="#_kuadrant_list_of_underlying_components"></a><a class="link" href="#_kuadrant_list_of_underlying_components">4.3. Kuadrant: list of underlying components</a></h3>
<div class="sect3">
<h4 id="_dns_operator"><a class="anchor" href="#_dns_operator"></a><a class="link" href="#_dns_operator">4.3.1. DNS Operator</a></h4>
<div class="paragraph">
<p>DNS operator consumes DNSRecord resources that are configured via the <strong>DNSPolicy</strong> API and applies them into the targeted cloud DNS provider. AWS, Azure and Google DNS are our main targets.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cert_manager_for_tls_policy"><a class="anchor" href="#_cert_manager_for_tls_policy"></a><a class="link" href="#_cert_manager_for_tls_policy">4.3.2. Cert Manager for TLS Policy</a></h4>
<div class="paragraph">
<p>Manages TLS certificates for our components and for the Gateways. Consumes Certificate resources created by the Kuadrant operator in response to the TLSPolicy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authorino_operator_for_auth_policy"><a class="anchor" href="#_authorino_operator_for_auth_policy"></a><a class="link" href="#_authorino_operator_for_auth_policy">4.3.3. Authorino Operator for Auth Policy</a></h4>
<div class="paragraph">
<p>External authorization server fully manageable via Kubernetes Custom Resources. Supports JWT authentication, API key, mTLS, pattern-matching authz, OPA, K8s SA tokens, K8s RBAC, external metadata fetching, and more, with minimum to no coding at all, no rebuilding of your applications.<br>
Ref: <a href="https://docs.kuadrant.io/0.8.0/authorino/" class="bare">https://docs.kuadrant.io/0.8.0/authorino/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_limitador_operator_for_ratelimits"><a class="anchor" href="#_limitador_operator_for_ratelimits"></a><a class="link" href="#_limitador_operator_for_ratelimits">4.3.4. Limitador Operator for Ratelimits</a></h4>
<div class="paragraph">
<p>Limitador is a generic rate-limiter and can be enabled using RateLimit APIs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_policies"><a class="anchor" href="#_policies"></a><a class="link" href="#_policies">4.4. Policies</a></h3>
<div class="paragraph">
<p>Kuadrant at its heart, provides Gateway Policies for Kubernetes. To quote <a href="https://kuadrant.io/" class="bare">https://kuadrant.io/</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Gateways play a pivotal role in application connectivity. With Kuadrant, platform engineers and application developers can easily connect, secure and protect their services and infrastructure using its powerful policy APIs</p>
</div>
</blockquote>
</div>
<div class="sect3">
<h4 id="_policy_attachement"><a class="anchor" href="#_policy_attachement"></a><a class="link" href="#_policy_attachement">4.4.1. Policy Attachement</a></h4>
<div class="paragraph">
<p>Policy Attachment augments the behavior of an object to add additional settings that can&#8217;t be described within the spec of that object. A "Policy Attachment" is a specific type of resource that can affect specific settings across either one object (this is "Direct Policy Attachment"), or objects in a hierarchy (this is "Inherited Policy Attachment").<br>
Ref: <a href="https://gateway-api.sigs.k8s.io/reference/policy-attachment/" class="bare">https://gateway-api.sigs.k8s.io/reference/policy-attachment/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_defaults_and_overrides"><a class="anchor" href="#_defaults_and_overrides"></a><a class="link" href="#_defaults_and_overrides">4.4.2. Defaults and overrides</a></h4>
<div class="paragraph">
<p>AuthPolicy and RateLimitPolicy can be attached to Gateways or to HTTPRoutes, with cascading effects through the hierarchy that result in one effective policy per gateway-route combination.</p>
</div>
<div class="paragraph">
<p>Ref: More about <a href="https://docs.kuadrant.io/0.8.0/architecture/rfcs/0009-defaults-and-overrides/#policy-spec-resembling-more-the-target-spec" target="_blank" rel="noopener">defaults and overrides</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_red_hat_build_of_keycloak_for_oauth"><a class="anchor" href="#_red_hat_build_of_keycloak_for_oauth"></a><a class="link" href="#_red_hat_build_of_keycloak_for_oauth">4.5. Red Hat build of Keycloak for OAuth</a></h3>
<div class="paragraph">
<p><a href="https://access.redhat.com/products/red-hat-build-of-keycloak/" target="_blank" rel="noopener">Red Hat build of Keycloak</a> is a cloud-native Identity Access Management solution based on the popular open source <a href="https://keycloak.org/" target="_blank" rel="noopener">Keycloak project</a></p>
</div>
<div class="paragraph">
<p>This Solution Pattern leverages Keycloak to setup authentication mechanism within the APIPolicy CR. An AuthPolicy can be setup either based on an API Key or Oauth, while OAuth is more preferrable.</p>
</div>
<div class="paragraph">
<p>Here is an excerpt of an AuthPolicy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  rules:
    authentication:
      "keycloak-users":
        jwt:
          issuerUrl: https://sso.mykeycloak.example.com/realms/realmname
    response:
      success:
        dynamicMetadata:
          identity:
            json:
              properties:
                userid:
                  selector: auth.identity.sub</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Note that the Keycloak&#8217;s Issuer URL is configured within the AuthPolicy, and also the <code>userid</code> from the JWT token is being used an identifier.</p>
</li>
<li>
<p>The mobile application used the same Keycloak realm for user authentication.</p>
</li>
<li>
<p>Once the user logs in, the JWT token from the app is then analysed for validity as pet the APIPolicy (this is done by by <a href="https://github.com/Kuadrant/authorino" target="_blank" rel="noopener">Authorino</a> which is a lightweight Envoy external authorization server)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html" class="query-params-link">1. Home page</a></span>
  <span class="next"><a href="03-demo.html" class="query-params-link">3. See the Solution in Action</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer" style="justify-content: center;">
  <div>
    <img src="./_images/red_hat_logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns" href="https://redhat.com">
  </div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
